## 用树桩代替子组件

### 背景

- 父组件中包含子组件，子组件中有网络请求
- 父组件的渲染会触发子组件的渲染，但不希望子组件内部的网络请求干扰到父组件的测试
- 延伸：当子组件有模块依赖时，如何避免其真实发生而干扰到父组件的测试

### 解决方法

如果父组件中包含的子组件较少，且场景简单，可以通过模拟子组件的行为来减少对父组件的影响

如果父组件包含复杂的子组件，最好的方式就是`完全模拟`加载完好的子组件，即调用完api后组件的形态，这样对子组件的模拟称作一个树桩(stub)

### 实例

父组件内依赖子组件，在父组件的test套件中使用mount挂载父组件，从而会触发子组件的created和mounted钩子。

```
MessageContainer created
MessageDisplay created
MessageDisplay mounted
MessageContainer mounted
```

> 深度优先遍历嵌套组件关系

所以要在父组件的mount时传入第二个参数`stubs`用来填充挂载好的子组件

通过wrapper查找父组件中的子组件元素以验证模拟填充生效


### 使用树桩的优点和缺点

#### 优点

- 隔离所测试的组件
- 一次只测一件事
- 准确找到代码哪里出问题

#### 过渡使用树桩的缺点

##### 维护代价

因为树桩只是对于组件的一种填充，当真实组件逻辑变了之后我们需要相应地更新我们的树桩

##### 减少信心

因为树桩不是真正渲染出的组件，所以其实在降低组件的覆盖率，降低对于组件质量的信心

> 虽然有这些问题，但是树桩对于模拟组件模块和服务层方面还是比较好的实践，可以巧妙使用

### 浅挂载如何

- 浅挂载有着和使用树桩同样的问题——降低对组件的信心
- 当使用其他测试工具，比如Vue testing库时不支持浅挂载

[浅挂载弊端拓展](https://kentcdodds.com/blog/why-i-never-use-shallow-rendering)